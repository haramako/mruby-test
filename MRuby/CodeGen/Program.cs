using System;
using MRuby;
using MRuby.CodeGen;

class Program
{
    static void Main(string[] args)
    {
        var gen = new CodeGenUtil();
        var mrubyTypes = CodeGenUtil.GetMRubyClasses(new string[] { "MRubyLib"});
        mrubyTypes.Add(typeof(Array));

        var reg = new Registry();

        foreach (var t in mrubyTypes)
        {
            Console.WriteLine(t);
            gen.RegisterClass(reg, t);
        }

        var printer = new RegistryPrinter();
        printer.PrintRegistry(reg);

        var path = "../CodeGenTest/AutoGenerated/";

        foreach (var cls in reg.AllNamespaces())
        {
            if (!cls.IsNamespace)
            {
                CodeGenerator cg = new CodeGenerator(reg, cls, path);
                cg.givenNamespace = "";
                cg.Generate();
            }
        }

        CodeGenUtil.GenerateBind(reg, path);
        Console.WriteLine("Generated");
    }
}
